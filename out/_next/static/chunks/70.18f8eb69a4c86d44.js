"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[70],{1070:function(e,n,r){r.r(n),r.d(n,{default:function(){return O}});var t=r(7568),i=r(9815),u=r(655),o=r(5893),a=r(6665),c=r(9e3),s=r(7765),l=r(7294),f=r(9477),d=r(2854),p=r(1217),h=r(3397),m=r(4878),v=r(8794),A=r.n(v),g=r(2462),y=r.n(g),w=r(1799),x=r(9396),b=Math.floor,M=function(e,n){return e.reduce(function(e,r,t){var i=b(t/n);return 0==t%n&&e.push([]),e[i].push(r),e},[])},E=function(e){return e.map(function(e){return String.fromCharCode(e)}).join("")},I=function(e){return e.map(function(e,n){return e*Math.pow(2,8*n)}).reduce(function(e,n){return e+n},0)<<32>>32},z=function(e,n){for(var r=[];0!=e.length;){var t=M(e.slice(0,12),4),i=E(t[0]),u=I(t[1]),o=I(t[2]);r.push(P(e,i,u,o,n)),e=e.slice(12+u)}return r},P=function(e,n,r,t,i){var u=12+r,o=e.slice(12,u),a=e.slice(u,u+t);return{id:n,data:i(n,o),children:z(a,i)}},j=function(e,n,r){var t;return z(e.slice(n),r)[0]},C=function(e){return[].concat.apply([],e)},B=function(e){for(var n={},r=0,t=I(e.splice(0,4));r<t;){var i=I(e.splice(0,4)),u=E(C(e.splice(0,i))),o=I(e.splice(0,4)),a=E(e.splice(0,o));r++,n[u]=a}return n},S=function(e,n){var r=M(n,4);if("PACK"===e)return{numModels:I(r[0])};if("SIZE"===e)return r[0]||console.log("SIZE chunk has no data"),{x:I(r[0]),y:I(r[1]),z:I(r[2])};if("XYZI"===e)return{numVoxels:I(r[0]),values:r.slice(1).map(function(e){return{x:e[0],y:e[1],z:e[2],i:e[3]}})};if("RGBA"===e)return{values:r.map(function(e){return{r:e[0],g:e[1],b:e[2],a:e[3]}})};if("nTRN"===e){for(var t={nodeId:I(n.splice(0,4)),nodeAttributes:B(n),child:I(n.splice(0,4)),reserved:I(n.splice(0,4)),layer:I(n.splice(0,4)),numFrames:I(n.splice(0,4)),frames:[]},i=0;i<t.numFrames;i++)t.frames.push(B(n));return t}if("nGRP"===e){for(var u={nodeId:I(n.splice(0,4)),nodeAttributes:B(n),child:I(n.splice(0,4)),children:[]},o=0;o<u.child;o++)u.children.push(I(n.splice(0,4)));return u}if("nSHP"===e){for(var a={nodeId:I(n.splice(0,4)),nodeAttributes:B(n),numModels:I(n.splice(0,4)),models:[]},c=0;c<a.numModels;c++)a.models.push([I(n.splice(0,4)),B(n),]);return a}if("MATL"===e)return{materialId:I(n.splice(0,4)),materialProperties:B(n)};if("LAYR"===e)return{layerId:I(n.splice(0,4)),layerAttributes:B(n),reservedId:I(n.splice(0,4))};if("rOBJ"===e)return{renderAttributes:B(n)};if("rCAM"===e)return{cameraId:I(n.splice(0,4)),cameraAttributes:B(n)};if("NOTE"===e){for(var s={numColorNames:I(n.splice(0,4)),colorNames:[]},l=0;l<s.numColorNames;l++){var f=I(n.splice(0,4));s.colorNames.push(E(C(n.splice(0,f))))}return s}return"IMAP"===e?{indexAssociations:n.splice(0,256)}:{}},Z=r(828),R=function(e){var n={};return e.children.forEach(function(e){var r=n[e.id];r||(r=[]),r.push(R(e)),n[e.id]=r}),Object.entries(e.data).forEach(function(e){var r=(0,Z.Z)(e,2),t=r[0],i=r[1];n[t]=i}),n.index=e.index,n},N=function(e){var n=(0,i.Z)(e);M(n,4);var r=j(n,8,S);return r.children=r.children.map(function(e,n){return(0,x.Z)((0,w.Z)({},e),{index:n})}),R(r)},O=function(e){var n=e.model,r=e.isEnlarged,v=void 0!==r&&r,g=(e.onBase64Changed,e.onErrorOccured),w=void 0===g?function(){}:g,x=e.onLoadingStarted,b=void 0===x?function(){}:x,M=e.onLoadingEnd,E=void 0===M?function(){}:M,I=e.isVoxels,z=void 0!==I&&I,P=e.isDcl,j=void 0!==P&&P,C=(0,l.useState)(),B=C[0],S=C[1],Z=(0,l.useState)([]),R=Z[0],O=Z[1],_=new p.E,k=new d._;k.setDecoderPath("./draco/"),_.setDRACOLoader(k);var F=(0,l.useRef)(null),L=(0,l.useRef)(),V=(0,l.useRef)(),D=(0,s.y)(),G=D.camera,U=D.size,H=U.width,T=U.height,Y=D.gl,J=D.scene;D.viewport;var W,X=(0,l.useState)(function(){return new f.AnimationMixer})[0];(0,s.z)(function(e,n){X.update(n),R&&R.length>0&&(G.position.x+=.01,G.updateProjectionMatrix())});var K=(W=(0,t.Z)(function(e){var n,r,t,o,a,c,s,l,d,p,v,g,x,M,I,P,j,C,B,Z,R,k,L,V,D,G,U,H,T,Y,J,W;return(0,u.__generator)(this,function(u){switch(u.label){case 0:if(u.trys.push([0,6,,7]),b(),n=-Math.PI,!z)return[3,4];return o=255,[4,fetch(e)];case 1:return[4,(a=u.sent()).arrayBuffer()];case 2:return a=u.sent(),c=new Uint8Array(a),l=(s=N(c)).XYZI[0].values||(null===(r=s.xyzi)||void 0===r?void 0:r.values),d=s.SIZE[0]||s.size,v=(s.RGBA[0].values||(null===(t=s.rgba)||void 0===t?void 0:t.values)).map(function(e){return[e.r,e.g,e.b]}),g=y()([d.x,d.y,d.z]),l.forEach(function(e){var n=e.x,r=e.y,t=e.z,i=e.i;return g.set(n,r,t,i)}),g=g.transpose(1,2,0),M=(x=A()(g)).vertices,I=x.normals,P=x.indices,j=x.voxelValues,B=v.map(function(e){return e.map(function(e){return e/o})}).map(function(e){return e.map(function(e){return Math.pow(e,2.2)})}),Z=[[0,0,0]].concat((0,i.Z)(B)),R=(0,h.Z)(j.map(function(e){return Z[e]})),(k=new f.BufferGeometry).setAttribute("position",new f.BufferAttribute(new Float32Array(M),3)),k.setAttribute("normal",new f.BufferAttribute(new Float32Array(I),3)),k.setAttribute("color",new f.BufferAttribute(new Float32Array(R),3)),k.setIndex(new f.BufferAttribute(new Uint32Array(P),1)),L=new f.MeshStandardMaterial({roughness:1,metalness:0}),V=new f.Mesh(k,L),[4,new m.M().parseAsync(V)];case 3:U=JSON.stringify(u.sent()),H=new Blob([U],{type:"text/plain"}),e=URL.createObjectURL(H),n+=Math.PI/2,u.label=4;case 4:return[4,_.loadAsync(e)];case 5:return(Y=(T=u.sent()).scene).rotation.y=n,J=T.animations,Y.traverse(function(e){e.frustumCulled=!1}),S(Y),F.current=Y,J&&J.length>0&&O(J),E(),[3,7];case 6:return W=u.sent(),console.log(W),w(),E(),[3,7];case 7:return[2]}})}),function(e){return W.apply(this,arguments)});return((0,l.useEffect)(function(){E(),K(n)},[n,v]),(0,l.useEffect)(function(){if(B&&null!==F.current)try{b();var e=new f.Box3().setFromObject(F.current,!0),n=e.getSize(new f.Vector3),r=e.getCenter(new f.Vector3(0,0,0)),t=Math.min(H/n.x,T/n.y);G.zoom=t;var i=Y.domElement;G.aspect=i.clientWidth/i.clientHeight,G.lookAt(r),j&&(G.zoom=Math.min(t/3*n.length()),v&&(G.zoom=Math.min(t/3*n.length()-50)),F.current.position.set(r.x,r.y-.9,r.z)),G.updateProjectionMatrix(),Y.render(J,G,null,!1),E()}catch(u){E()}},[B,v]),(0,l.useEffect)(function(){return R&&R.length>0&&v&&(L.current={idle:X.clipAction(R[0],F.current)},L.current.idle.play()),function(){return R.forEach(function(e){return X.uncacheClip(e)})}},[R,X,v]),B)?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.z,{ref:V,args:[G,Y.domElement],minPolarAngle:0,maxPolarAngle:Math.PI/1.75,target:[0,0,0],onEnd:function(){B&&F.current&&Y.render(J,G,null,!1)}}),(0,o.jsx)(c.M,{position:[0,j?v?0:-.9:0,0],children:(0,o.jsx)("group",{ref:F,position:[0,0,0],rotation:[0,j?Math.PI/1:0,0],dispose:null,children:(0,o.jsx)("primitive",{ref:F,position:[0,0,0],name:"Object_0",object:B,scale:Math.min(H/Y.domElement.clientWidth,T/Y.domElement.clientHeight),makeDefaults:!0})})})]}):null}}}]);